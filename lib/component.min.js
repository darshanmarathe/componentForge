import{html,render}from"https://cdn.jsdelivr.net/npm/lit-html@3.0.0/+esm";import{unsafeHTML}from"https://cdn.jsdelivr.net/npm/lit-html@3.0.0/directives/unsafe-html/+esm";class Component extends HTMLElement{async BuildProps(){var t=this.getAttributeNames();if(0!==t.length){var e,s={};for(const i of t)i.toLowerCase().startsWith("data-")?(e=JSON.parse(this.getAttribute(i)||"{}"),s[i.replace("data-","")]="object"==typeof this.getAttribute(i)?this.getAttribute(i):e):s[i]=this.getAttribute(i);this.props=Object.assign(Object.assign({},this.props),s)}}get(s){return new Promise((e,t)=>{fetch(s).then(async t=>{t=t.json();e(t)}).catch(t=>{e(t)})})}loadScript(i,o){return new Promise((t,e)=>{let s=document.getElementById(i);s?t():((s=document.createElement("script")).src=o,s.id=i,s.async=!1,this.scripts.push(()=>{document.body.removeChild(s)}),document.body.appendChild(s),s.onload=()=>{t()})})}loadCss(t,e){let s=this.root.getElementById(t);s||((s=document.createElement("link")).href=e,s.id=t,s.rel="stylesheet"),this.root.appendChild(s),this.scripts.push(()=>{this.root.removeChild(s)})}post(s,i){return new Promise(async(t,e)=>{try{t(await(await fetch(s,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(i)})).json())}catch(t){e(t)}finally{this.Log(`POST Request finished for ${s} `+JSON.stringify(i))}})}constructor(t=!0,e={}){if(super(),this.props={},this.state={},this.scripts=[],void 0===this.Template&&void 0===this.Style)throw new Error("Template and Style functions are required....");0<Object.keys(e).length&&(this.props=e),t?this.root=this.attachShadow({mode:"open"}):(this.innerHTML="",this.root=this),this.BuildProps(),this.makeDynamicProps(),this.Template.bind(this),this.Style.bind(this),this.slotChnaged&&this.slotChnaged.bind(this),null!=(e=this.root.querySelectorAll("slot"))&&e.forEach(t=>{t.addEventListener("slotchange",t=>{this.slotChnaged&&this.slotChnaged(t),this.ComponentDidMount&&this.ComponentDidMount()})}),setTimeout(()=>{this.PreRender(),this.GetSlots()},100)}GetSlots(){this.slots=this.root.querySelectorAll("slot"),this.slots.forEach((t,e)=>{if(!t.hasAttribute("handled")){var s=t.assignedNodes();if(0<s.length){for(const i of s[0].getAttributeNames())-1<["name","id","slot"].indexOf(i)||(s[0][i]=t[i]);t.setAttribute("handled",!0)}}})}makeDynamicProps(){this.props&&Object.keys(this.props).length&&Object.keys(this.props).forEach(s=>{Object.defineProperty(this,s,{get(){return this.getAttribute(s)},set(t){var e=this.props[s];console.log(s,e,t),void 0!==t?(this.setAttribute(s,t),e!==(this.props[s]=t)&&this.PreRender()):this.removeAttribute(s),this.ComponentDidReceiedProps&&this.ComponentDidReceiedProps(s,e,t)}})})}setState(t,e=!0,s=()=>{}){this.state=Object.assign(this.state,t),!0===e&&this.PreRender(),s()}PreRender(){render(html`${this.Style()} ${this.Template()}`,this.root),this.GetSlots()}Tmpl(e,t,s=null){let i=t;"string"==typeof s&&((t=document.createElement("div")).innerHTML=s,s=t.children[0]);t=i.match(/{(.*?)}/g);if(null!=t&&t.forEach(t=>{t=t.replace("{","").replace("}",""),i=-1===t.indexOf(".")?i.replace(`{${t}}`,e[t]):i.replace(`{${t}}`,((t,e)=>{let s=e;for(const o of t.split(".")){var i=o.split("."),i=1<i.length?i[1]:i[0];s=s[i]}return s})(t,e))}),s)for(const o of Object.keys(e))s[o]=e[o];return null!==s&&""!==i?(s.innerHTML=unsafeHTML(i),unsafeHTML(i)):null===s&&""!==i?unsafeHTML(i):s}Log(...t){this.props.debug&&console.log(...t)}async connectedCallback(){this.ComponentDidMount&&await this.ComponentDidMount()}async disconnectedCallback(){this.scripts.forEach(t=>t()),this.ComponentWillUnmount&&await this.ComponentWillUnmount()}attributeChangedCallback(t,e,s){console.log(t,"attribute changed"),this.BuildProps()}fireEvent(t,e,s,i=!0,o=!0){e&&""!=e&&(this[e]=s),this.dispatchEvent(new CustomEvent(t,{detail:s,bubbles:i,composed:o}))}getProps(t=!1){return t?JSON.stringify(this.props,null,4):this.props}getState(t=!1){return t?JSON.stringify(this.state,null,4):this.state}}function Tag(t,e){window.customElements.define(t,e)}export{Component,html,Tag};
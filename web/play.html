<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ComponentForge - Playground</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link rel="stylesheet" href="./css/style.css" />

    <script src="https://code.jquery.com/jquery-3.6.2.min.js"
        integrity="sha256-2krYZKh//PcchRtd+H+VyyQoZ/e3EcrkxhM8ycwASPA=" crossorigin="anonymous"></script>

</head>

<body>

    <div>
        <div class="row">
            <div class="col-6">
                <div class="container">
                <select class="form-control" style="width: 100%" name="code" id="code">
                    <option value="">Select</option>
                </select>
                </div>
            </div>
            <br>
            <div class="col-6">
                <div class="container">
                <form target="prev" action="preview" method="post">
                    Preview
                    <input id="run" class="btn btn-primary" type="submit" value="Run">

                    <input type="hidden" placeholder="html" name="html" id="hidhtml">
                    <input type="hidden" placeholder="wc" name="wc" id="hidwc">
                    <input type="hidden" placeholder="js" name="js" id="hidjs">



                </form>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-6">
                <div class="container">


                    <div class="tabs">
                        <div class="tabby-tab">
                            <input type="radio" id="tab-1" name="tabby-tabs" checked>
                            <label for="tab-1">Web Component</label>
                            <div class="tabby-content">
                                <code-editor id="codeEditor"></code-editor>
                            </div>
                        </div>

                        <div class="tabby-tab">
                            <input type="radio" id="tab-2" name="tabby-tabs">
                            <label for="tab-2">HTML</label>
                            <div class="tabby-content">
                                <code-editor language="html" id="codeEditorHTML"></code-editor>
                            </div>
                        </div>

                        <div class="tabby-tab">
                            <input type="radio" id="tab-3" name="tabby-tabs">
                            <label for="tab-3">Page JS</label>
                            <div class="tabby-content">
                                <code-editor id="codeEditorJS"></code-editor>
                            </div>
                        </div>

                    </div>

                </div>
               
            </div>

            <div class="col-6">
                <div class="container" style="padding: 0px;">
                <iframe name="prev">
                    Hello
                </iframe>
           </div>
            </div>
        </div>
       
    </div>
    </div>

    <pre class="hidden" id="basic">
import {Component , html , Tag} from 'https://cdn.jsdelivr.net/npm/componentforge@1.1.17';


export default class Basic extends Component {
    Template(){
        return html`Hello ${this.props.name || 'world'}
        <br>
        You are cool 
        
        `
    }

    Style(){
        return ''
    }
}


Tag('cf-basic' , Basic)
         
    </pre>
    
    <pre class="hidden noShow" id="basicHTML">
        <cf-basic id="basic" name="john"></cf-basic>
    </pre>


    <pre class="hidden noShow" id="basicJS">
        function doSomething(){
            setTimeout(function(){
                    document.getElementById('basic').name ="DoSomething"
            }, 2000)
        }
        
        doSomething();
            </pre>
        

    <pre class="hidden" id="PropsAndState" title="Props and state">
import {Component , html , Tag} from 'https://cdn.jsdelivr.net/npm/componentforge@1.1.17';


export default class CountDown extends Component{
    

constructor(){
    const  _props ={
        count : 0,
        interval : 1000
    };
    super(true , _props);
    this.state = {
        count: +this.props.count
    };

    this.Init.bind(this);

    this.Init();
}


Init(){
    const that = this;
    const inter = setInterval(function() {
        console.log(that.state.count);
        that.setState({
            count : that.state.count- 1
        });
        that.fireEvent("tick" , "value", {count : that.state.count , prevCount : that.state.count+ 1});
        if(that.state.count === 0) {
            clearInterval(inter);

        }
    }, +this.props.interval)
}

    Template(){

        return html`
            <h2>${this.state.count}/${this.props.count}</h2>
            `
    }

    Style(){
        return html`
        <style>
            h2{
                color:red
            }
        
        </style>
        `
    }

}

Tag("cf-countdown" , CountDown)
        
        </pre>


<pre class="hidden noShow" id="PropsAndStateHTML">

<cf-countdown count="20" id="countDown" interval="500"></cf-countdown>

</pre>


<pre class="hidden noShow" id="PropsAndStateJS">

document.getElementById('countDown')
.addEventListener('tick' , function(e) {
console.log(e.detail)
})
                    
</pre>


<pre class="hidden" id="Events" title="Fire events">
    // Yet to come

</pre>

<pre class="hidden" id="Templating" title="Micro Templating">
    // Yet to come
</pre>

    <script src="./js/codeeditor.js" type="module"></script>

    <script type="module">

        $(function () {


            let strOptions = $("#code").html();

            $("pre").each(function () {
                if($(this).hasClass("noShow")) return;
                const str = ` <option value="${$(this).prop("id")}">${$(this).prop("title") || $(this).prop("id")
                    }</option>`;
                strOptions += str;
            });

            $("#code").html(strOptions);
            document.querySelector("#code").addEventListener("change", (e) => {
                const codeContainer = "#" + e.target.value;
                let code = document.querySelector(codeContainer).innerHTML;
                document.querySelector("#codeEditor").value = code;

                const codeContainerHTML = codeContainer + "HTML" ;
                 code = document.querySelector(codeContainerHTML)?.innerHTML;
                document.querySelector("#codeEditorHTML").value = code;

                const codeContainerJS = codeContainer + "JS" ;
                 code = document.querySelector(codeContainerJS)?.innerHTML;
                document.querySelector("#codeEditorJS").value = code;


            });

            $("#run").click((e) => {


                $('#hidwc').val(document.querySelector("#codeEditor").Code || "")

                $('#hidjs').val(document.querySelector("#codeEditorJS").Code || "")
                
                $('#hidhtml').val(document.querySelector("#codeEditorHTML").Code || "")
              

            });
        }); 




    </script>


</body>

</html>